/*!
 * dom-navigator - v1.1.0 - 2016-07-31
 *
 * https://github.com/rmariuzzo/dom-navigator
 * Copyright (c) 2014, 2016 Rubens Mariuzzo Licensed MIT
 */
"use strict";function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},_createClass=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}();!function(a){"function"==typeof define&&define.amd?define([],function(){return a(window.jQuery)}):a(window.jQuery)}(function(a){function b(a){a=a||{};for(var b=1;b<arguments.length;b++)if(arguments[b])for(var c in arguments[b])arguments[b].hasOwnProperty(c)&&(a[c]=arguments[b][c]);return a}function c(a,b){a.classList?a.classList.add(b):a.className+=" "+b}function d(a,b){a.classList?a.classList.remove(b):a.className=a.className.replace(new RegExp("(^|\\b)"+b.split(" ").join("|")+"(\\b|$)","gi")," ")}function e(a){return a.jquery||Array.isArray(a)?a[0]:a}function f(a){var b=a.getBoundingClientRect();return b.top>=0&&b.left>=0&&b.bottom<=window.innerHeight&&b.right<=window.innerWidth}function g(a){var b=0;do isNaN(a.offsetTop)||(b+=a.offsetTop);while(a=a.offsetParent);return b}function h(a){var b=0;do isNaN(a.offsetLeft)||(b+=a.offsetLeft);while(a=a.offsetParent);return b}var i=this,j=function(){function a(c,d){_classCallCheck(this,a),this.$doc=window.document,this.$container=c,this.$options=b({},a.DEFAULTS,d),this.init()}return _createClass(a,null,[{key:"DIRECTION",get:function(){return{left:"left",up:"up",right:"right",down:"down"}}},{key:"MODE",get:function(){return{auto:"auto",horizontal:"horizontal",vertical:"vertical",grid:"grid"}}},{key:"DEFAULTS",get:function(){return{mode:a.MODE.auto,selected:"selected",left:37,up:38,right:39,down:40,cols:0}}}]),_createClass(a,[{key:"init",value:function(){if(this.validateOptions(),this.$selected=null,this.$keydownHandler=null,this.$keys={},this.$keys[this.$options.left]=this.left,this.$keys[this.$options.up]=this.up,this.$keys[this.$options.right]=this.right,this.$keys[this.$options.down]=this.down,this.$options.mode===a.MODE.grid&&!this.$options.cols){for(var b=this.elements(),c=[],d=0;d<b.length&&!(d>0&&c[d-1]!==b[d].offsetTop);d++)c[d]=b[d].offsetTop;this.$options.cols=c.length}this.enable()}},{key:"validateOptions",value:function(){var b=!1;for(var c in a.MODE)b=b||this.$options.mode===a.MODE[c];if(!b)throw new Error("Unsupported navigation mode: "+this.$options.mode)}},{key:"enable",value:function(){var a=this;this.$keydownHandler=function(b){a.handleKeydown.call(a,b)},this.$doc.addEventListener("keydown",this.$keydownHandler)}},{key:"disable",value:function(){this.$keydownHandler&&this.$doc.removeEventListener("keydown",this.$keydownHandler)}},{key:"destroy",value:function(){this.disable(),this.$container.domNavigator&&delete this.$container.domNavigator}},{key:"left",value:function(){var b=this,c=null;!function(){switch(b.$options.mode){case a.MODE.auto:if(!b.$selected){c=b.elements()[0];break}var d=b.$selected.offsetLeft-1,e=b.$selected.offsetTop;c=b.elementsBefore(d,1/0).reduce(function(a,b){var c=Math.abs(d-b.offsetLeft)+Math.abs(e-b.offsetTop);return c<a.distance?{distance:c,element:b}:a},{distance:1/0}),c=c.element;break;case a.MODE.horizontal:if(!b.$selected){c=b.elements()[0];break}c=b.$selected.previousElementSibling;break;case a.MODE.vertical:break;case a.MODE.grid:if(!b.$selected){c=b.elements()[0];break}var f=b.elements().indexOf(b.$selected);f%b.$options.cols!==0&&(c=b.$selected.previousElementSibling)}}(),this.select(c,a.DIRECTION.left)}},{key:"up",value:function(){var b=this,c=null;!function(){switch(b.$options.mode){case a.MODE.auto:if(!b.$selected){c=b.elements()[0];break}var d=b.$selected.offsetLeft,e=b.$selected.offsetTop-1;c=b.elementsBefore(1/0,e).reduce(function(a,b){var c=Math.abs(d-b.offsetLeft)+Math.abs(e-b.offsetTop);return c<a.distance?{distance:c,element:b}:a},{distance:1/0}),c=c.element;break;case a.MODE.horizontal:break;case a.MODE.vertical:if(!b.$selected){c=b.elements()[0];break}c=b.$selected.previousElementSibling;break;case a.MODE.grid:if(!b.$selected){c=b.elements()[0];break}c=b.$selected;for(var f=0;f<b.$options.cols;f++)c=c&&c.previousElementSibling}}(),this.select(c,a.DIRECTION.up)}},{key:"right",value:function(){var b=this,c=null;!function(){switch(b.$options.mode){case a.MODE.auto:if(!b.$selected){c=b.elements()[0];break}var d=b.$selected.offsetLeft+b.$selected.offsetWidth,e=b.$selected.offsetTop;c=b.elementsAfter(d,0).reduce(function(a,b){var c=Math.abs(b.offsetLeft-d)+Math.abs(b.offsetTop-e);return c<a.distance?{distance:c,element:b}:a},{distance:1/0}),c=c.element;break;case a.MODE.horizontal:if(!b.$selected){c=b.elements()[0];break}c=b.$selected.nextElementSibling;break;case a.MODE.vertical:break;case a.MODE.grid:if(!b.$selected){c=b.elements()[0];break}var f=b.elements().indexOf(b.$selected);0!==f&&(f+1)%b.$options.cols===0||(c=b.$selected.nextElementSibling)}}(),this.select(c,a.DIRECTION.right)}},{key:"down",value:function(){var b=this,c=null;!function(){switch(b.$options.mode){case a.MODE.auto:if(!b.$selected){c=b.elements()[0];break}var d=b.$selected.offsetLeft,e=b.$selected.offsetTop+b.$selected.offsetHeight;c=b.elementsAfter(0,e).reduce(function(a,b){var c=Math.abs(b.offsetLeft-d)+Math.abs(b.offsetTop-e);return c<a.distance?{distance:c,element:b}:a},{distance:1/0}),c=c.element;break;case a.MODE.horizontal:break;case a.MODE.vertical:if(!b.$selected){c=b.elements()[0];break}c=b.$selected.nextElementSibling;break;case a.MODE.grid:if(!b.$selected){c=b.elements()[0];break}c=b.$selected;for(var f=0;f<b.$options.cols;f++)c=c&&c.nextElementSibling}}(),this.select(c,a.DIRECTION.down)}},{key:"selected",value:function(){return this.$selected}},{key:"select",value:function(a,b){a&&a!==this.$selected&&(a=e(a),this.$selected&&d(this.$selected,this.$options.selected),this.scrollTo(a,b),c(a,this.$options.selected),this.$selected=a)}},{key:"scrollTo",value:function(b,c){if(b=e(b),this.inContainerViewport(b)){if(!f(b))switch(c){case a.DIRECTION.left:document.body.scrollLeft=h(b)-document.body.offsetLeft;break;case a.DIRECTION.up:document.body.scrollTop=g(b)-document.body.offsetTop;break;case a.DIRECTION.right:document.body.scrollLeft=h(b)-document.body.offsetLeft-(document.documentElement.clientWidth-b.offsetWidth);break;case a.DIRECTION.down:document.body.scrollTop=g(b)-document.body.offsetTop-(document.documentElement.clientHeight-b.offsetHeight)}}else switch(c){case a.DIRECTION.left:this.$container.scrollLeft=b.offsetLeft-this.$container.offsetLeft;break;case a.DIRECTION.up:this.$container.scrollTop=b.offsetTop-this.$container.offsetTop;break;case a.DIRECTION.right:this.$container.scrollLeft=b.offsetLeft-this.$container.offsetLeft-(this.$container.offsetWidth-b.offsetWidth);break;case a.DIRECTION.down:this.$container.scrollTop=b.offsetTop-this.$container.offsetTop-(this.$container.offsetHeight-b.offsetHeight)}}},{key:"inContainerViewport",value:function(a){return a=e(a),!(a.offsetLeft-this.$container.scrollLeft<this.$container.offsetLeft)&&(!(a.offsetTop-this.$container.scrollTop<this.$container.offsetTop)&&(!(a.offsetLeft+a.offsetWidth-this.$container.scrollLeft>this.$container.offsetLeft+this.$container.offsetWidth)&&!(a.offsetTop+a.offsetHeight-this.$container.scrollTop>this.$container.offsetTop+this.$container.offsetHeight)))}},{key:"elements",value:function(){for(var a=[],b=this.$container.children.length;b--;)8!==this.$container.children[b].nodeType&&a.unshift(this.$container.children[b]);return a}},{key:"elementsAfter",value:function(a,b){return this.elements().filter(function(c){return c.offsetLeft>=a&&c.offsetTop>=b})}},{key:"elementsBefore",value:function(a,b){return this.elements().filter(function(c){return c.offsetLeft<=a&&c.offsetTop<=b})}},{key:"handleKeydown",value:function(a){this.$keys[a.which]&&(a.preventDefault(),this.$keys[a.which].call(this))}}]),a}();window.DomNavigator=j,a&&!function(){var b=a.fn.domNavigator;a.fn.domNavigator=function(a){for(var b=arguments.length,c=Array(b>1?b-1:0),d=1;d<b;d++)c[d-1]=arguments[d];var e=void 0;return this.each(function(b,d){d.domNavigator||(d.domNavigator=new j(d,"object"===("undefined"==typeof a?"undefined":_typeof(a))&&a)),"string"==typeof a&&d.domNavigator[a]&&(e=d.domNavigator[a].apply(d.domNavigator,c))}),void 0===e&&(e=this),e},a.fn.domNavigator.Constructor=j,a.fn.domNavigator.noConflict=function(){return a.fn.domNavigator=b,i}}()});